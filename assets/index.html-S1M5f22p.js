import{_ as o,c as t,a as i,o as n}from"./app-Cwg-pqKw.js";const c={};function a(r,e){return n(),t("div",null,e[0]||(e[0]=[i('<p>原因是“触发结构改变 + 注销时机”叠加导致的短暂空引用。</p><p>把“安全退出”的触发改为“整卡可点”后，触发结构从“内部元素触发”变成“包含式/整块触发”（原本<code>a-popconfirm</code> 只包裹“安全退出”的文字，后来我改成了<code>a-popconfirm</code>包裹 <code>card-item</code>整个卡片）。 AntD 的 Popconfirm 在确认时会先触发一次可见性变更（触发器区域会重渲），而我们在确认回调里立即把 <code>info</code> 清空（<code>setUserInfo(null)</code>）。这两件事在同一帧里交织，导致“触发器区域或信息卡片在重渲过程中读到了已被置空的 <code>info.name</code>”，从而出现瞬时的 cannot read properties of null (reading &#39;name&#39;)。</p><p>为何之前没问题的可能原因：</p><ul><li>之前只重绘了不包含<code>info.name</code>的文字span区域</li><li>之前的触发点只在文字元素上，触发链更短，Popconfirm 收起的重渲范围更小，恰好没有踩中 info 被清空的这帧渲染窗口。</li></ul><p>修复：</p><ul><li><ol><li></li></ol><ul><li>模板里为 <code>info</code> 相关插值加了空值保护（名字、邮箱）。</li><li>为信息卡主体加 <code>v-if=&quot;info&quot;</code>，避免 info 置空时再渲染其内部。</li></ul></li><li><ol start="2"><li></li></ol><ul><li>在 <code>logout()</code> 中先关闭信息卡，再等一帧再清空用户： <ul><li>先 <code>this.infoCardVisible = false</code></li><li><code>await this.$nextTick()</code> 等待信息卡与 Popconfirm 收起渲染完成</li><li>再执行 <code>await userApi.logout()</code>、<code>this.$router.replace({ name: &#39;login&#39; })</code></li><li>最后 <code>this[&#39;user/setUserInfo&#39;](null)</code>（或放在路由完成后的回调里）</li></ul></li></ul></li></ul>',6)]))}const p=o(c,[["render",a]]),d=JSON.parse('{"path":"/home/xxxqit57/","title":"退出登陆后报空值错误","lang":"zh-CN","frontmatter":{"title":"退出登陆后报空值错误","createTime":"2025/08/29 14:55:34","permalink":"/home/xxxqit57/","description":"原因是“触发结构改变 + 注销时机”叠加导致的短暂空引用。 把“安全退出”的触发改为“整卡可点”后，触发结构从“内部元素触发”变成“包含式/整块触发”（原本a-popconfirm 只包裹“安全退出”的文字，后来我改成了a-popconfirm包裹 card-item整个卡片）。 AntD 的 Popconfirm 在确认时会先触发一次可见性变更（触发...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"退出登陆后报空值错误\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-09-18T01:42:04.000Z\\",\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://niuck.cn/home/xxxqit57/"}],["meta",{"property":"og:site_name","content":"宁采柯的小窝"}],["meta",{"property":"og:title","content":"退出登陆后报空值错误"}],["meta",{"property":"og:description","content":"原因是“触发结构改变 + 注销时机”叠加导致的短暂空引用。 把“安全退出”的触发改为“整卡可点”后，触发结构从“内部元素触发”变成“包含式/整块触发”（原本a-popconfirm 只包裹“安全退出”的文字，后来我改成了a-popconfirm包裹 card-item整个卡片）。 AntD 的 Popconfirm 在确认时会先触发一次可见性变更（触发..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-09-18T01:42:04.000Z"}],["meta",{"property":"article:modified_time","content":"2025-09-18T01:42:04.000Z"}]]},"readingTime":{"minutes":1.28,"words":383},"git":{"createdTime":1756451968000,"updatedTime":1758159724000,"contributors":[{"name":"niuchangkang","username":"niuchangkang","email":"niuchangkang@telrobot.top","commits":2,"avatar":"https://avatars.githubusercontent.com/niuchangkang?v=4","url":"https://github.com/niuchangkang"}]},"autoDesc":true,"filePathRelative":"notes/home/实习相关/logout-bug.md","headers":[]}');export{p as comp,d as data};
